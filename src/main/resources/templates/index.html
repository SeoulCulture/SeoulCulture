<!doctype html>
<html lang="ko"  xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/index-header :: header"/>
<body class="text-center">

    <div id="main-title">
        <h2>뭐하러 가지?</h2>
    </div>

    <main class="form-sign">
<!--        어.. action을 꼭 지정해야 렌더링이 되네 왜그러지..-->
        <form id ="form" role="form" action="/culture/search" th:object="${cultureForm}", method="get">
            <table>
                <div>
                    <tr>
                        <td class="table-head"><label for="moods">기분</label></td>
                        <td><input id="moods" name="moods" th:field="*{moods}"></td>
                    </tr>
                </div>

                <div class="form-floating">
                    <tr>
                    <td class="table-head"><label for="time">소요 시간 (분)</label></td>
                    <td><input type="number" class="form-control" id="time" name="time", placeholder="소요 시간을 입력해주세요" th:field="*{time}"></td>
                    </tr>
                </div>

                <div class="form-floating">
                    <tr>
                    <td class="table-head">이동 수단</td>
                    <td>
                        <input type="radio" id="walking" name="howToGo" value="WALKING" th:checked="${cultureForm.howToGo == 'WALKING'}">
                        <label for="walking">도보</label>
                        <input type="radio" id="driving" name="howToGo" value="DRIVING" th:checked="${cultureForm.howToGo == 'DRIVING'}">
                        <label for="driving">차량</label>
                    </td>
                    </tr>
                </div>

                <div class="form-floating">
                    <tr>
                    <td class="table-head"><label for="price">비용 (원)</label></td>
                    <td>
                        <input type="number" class="form-control" id="price" name="price" placeholder="비용을 입력해주세요" th:field="*{price}">
                    </td>
                    </tr>
                </div>

                <div class="form-floating">
                    <tr>
                    <td class="table-head">무료</td>
                    <td>
                        <input type="checkbox" id="free" name="free" th:checked="${cultureForm.price == 0}">
                    </td>
                    </tr>
                </div>
            </table>
            <div id="submit-button">
                <button id = "submitBtn" class="btn btn-primary">고!!</button>
            </div>
        </form>
        <div>
            <p>장소 지정하기</p>
            <input type="text" id="searchInput" name="spot">
            <div id="searchResults"></div>
        </div>


        <div id="searchStatus" style="display: none;">검색 중입니다...</div>
    </main>
</body>

<script>
    $( document ).ready( function() {
        $( '#searchInput' ).on("propertychange change keyup paste input", function() {
            console.log("인풋 발생");
            const input = searchInput.value;
            const matches = findMatchingStrings(input, spotDtos);

            const resultsContainer = document.getElementById("searchResults");
            if (resultsContainer){
                resultsContainer.innerHTML = "";
                if (matches.length > 0) {
                    const resultList = document.createElement("ul");
                    matches.forEach(function (match) {
                        const listItem = document.createElement("li");
                        listItem.textContent = match;
                        resultList.appendChild(listItem);
                    });
                    resultsContainer.appendChild(resultList);
                } else {
                    resultsContainer.textContent = "선택 가능한 항목이 없습니다.";
                }
            }
        });
    });

    function findMatchingStrings(input, spotDtos) {
        const matches = [];

        spotDtos.forEach(function(spotDto) {
            if (spotDto.spotName.includes(input)) {
                matches.push(spotDto.spotName);
            }
        });

        return matches;
    }
</script>
</html>